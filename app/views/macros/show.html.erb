<div class="banner-macro d-flex flex-column">
  <div class="d-flex justify-content-between buttons">
    <div class="d-flex">
      <%= link_to macros_path, class: 'btn btn-secondary back-btn' do %>
        <i class="fas fa-arrow-left"></i> Back to the list
      <% end %>
    </div>
    <div class="d-flex align-items-center">
      <% if current_user.favorited?(@macro) %>
        <%= link_to unfavorite_path do %>
          <i class="fas fa-star mr-2"></i>
        <% end %>
      <% else %>
        <%= link_to favorite_path do %>
          <i class="far fa-star mr-2"></i>
        <% end %>
      <% end %>
      <% if current_user.email == "flavia@planetlanguages.com" %>
        <%= link_to "Edit", edit_macro_path(@macro), class: "btn btn-secondary back-btn mr-2" %>
        <%= link_to "Remove", macro_path(@macro), method: :delete, class: "btn btn-secondary back-btn"%>
      <% end %>
    </div>
  </div>

  <div class="container pt-5 text-center">
    <% if @macro.tag_list.include? "Word" %>
      <i class="fas fa-file-word office-icon show"></i>
    <% elsif @macro.tag_list.include? "Excel" %>
      <i class="fas fa-file-excel office-icon show"></i>
    <% elsif @macro.tag_list.include? "PowerPoint" %>
      <i class="fas fa-file-powerpoint office-icon show"></i>
    <% end %>
    <h1><%= @macro.name %></h1>
  </div>
</div>

<h2 class="header">Description</h2>
<%= simple_format(@macro.description) %>

<h2 class="header mb-0">Code</h2>
<div class="code-div">
  <figure class="custom-scrollbar">
    <a class="copy-btn mt-2" data-clipboard-target="#code-to-copy">Copy</a>
    <pre>
      <!-- put this in code class="language-markup language-visual-basic" -->
      <code class="py-0 language-visual-basic" id="code-to-copy" data-src-loaded>
        <%= @macro.code %>
      </code>
    </pre>
  </figure>
</div>




<h2 class="header mt-0">Tags</h2>
<% if @macro.tag_list.empty? %>
  <h5 class="text-secondary mb-4">No tags yet</h5>
<% else %>
  <% @macro.tag_list[0...-1].each do |tag| %>
    <%= link_to tag, macros_path(tags: tag), class: "tag" %>
  <% end %>
  <%= link_to @macro.tag_list[-1], macros_path(tags: @macro.tag_list[-1]), class: "tag" %>
<% end %>

<h2 class="header">Comments</h2>

<!-- New comment form -->
<%= simple_form_for [@macro, @comment] do |f| %>
  <div class="form-inputs">
    <% if controller_name == 'comments' && action_name == "edit" %>
      <%= f.input :content, input_html: { autocomplete: 'off', autofocus: "true" } %>
    <% else %>
      <%= f.input :content, input_html: { autocomplete: 'off' } %>
    <% end %>
  </div>

  <div class="form-actions">
    <%= f.submit 'Save', class: 'btn btn-purple btn-sm mb-4' %>
    <% if controller_name == 'comments' && action_name == "edit" %>
      <%= link_to 'Cancel', macro_path(@macro), class: 'btn btn-sm btn-outline-secondary mb-4' %>
    <% end %>
  </div>
<% end %>

<!-- If there are no comments -->
<% if @macro.comments.empty? %>
  <h5 class="text-secondary mb-4">No comments yet</h5>
<% else %>

<!-- If there are comments -->
    <div class="mb-4">
      <% @macro.comments.order('created_at DESC').each do |comment| %>
        <div class="comment">
          <%= image_tag "avatar.png", class: "avatar-large" %>
          <div class="comment-content">
            <p><small><%= comment.user.email.split("@")[0].capitalize %> - <%= comment.created_at.localtime.strftime("%A, %d %b %Y %l:%M %p") %></small></p>
            <p><%= comment.content %></p>
          </div>

          <% if comment.user == current_user %>
            <div class="comment-actions">
              <%= link_to  edit_macro_comment_path(@macro, comment) do %>
                Edit <i class="fas fa-pencil-alt"></i>
              <% end %>
              <%= link_to macro_comment_path(@macro, comment), method: :delete, data: {confirm: 'Are you sure you want to delete this comment?' } do %>
                Delete <i class="far fa-trash-alt"></i>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

<% end %>




